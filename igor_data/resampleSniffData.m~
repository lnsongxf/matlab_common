%resampleSniffData
rep = 500;
sampN = 150;
nback = 3;
% Figure 1 - Distance changes, turning probabilities
% ---------------------------------------------------
turnDirections = sniffData.turnDirections./abs(sniffData.turnDirections); %convert to signed 1's.
edges = -9:.5:9;
turnp = zeros(length(edges), nback, rep);
ND_resamp = zeros(length(edges), nback, rep);
deltaND_resamp = NaN*zeros(length(edges), nback, rep);
rsDND = NaN*zeros(50*sampN*(length(edges)-1),1);
rsND = NaN*zeros(50*sampN*(length(edges)-1),1);
for jj = 1:size(sniffData.dist_diffs,2)
    [N,bin] = histc(sniffData.dist_diffs(:,jj), edges);
    nbins = length(N);
    turnDND = [];
    for kk=1:rep
        for ii = 1:(nbins-1)
            [turnb, idx] = datasample(sniffData.bturn(bin == ii), sampN);
            turnp(ii,jj,kk) = sum(turnb);
            ti = (turnb == 1);
            ndSamp =sniffData.sniffPos(bin == ii, jj); %corresponding NDs
            ndSamp = ndSamp(idx);
            dNDsamp = sniffData.dist_diffs(bin==ii,jj); 
            dNDsamp = dNDsamp(idx);
            if(kk ==1 && jj==3)
                toti = (kk-1)*sampN*(ii-1) + (1:sampN);
                rsDND(toti) = dNDsamp;
                turnDND = cat(1, turnDND, dNDsamp(ti));
                rsND(toti) = ndSamp;
            end
            %NDresamp(
        end
    end
end
turnp(isnan(turnp)) = 0; %replace possible NaNs
mturnp = nanmean(turnp,3);
rsDND = rsDND(~isnan(rsDND));
rsND = rsND(~isnan(rsND));
% similar, but doing it using the turning triggered data.
for ii = 1:nbins
    for jj = 1:3
        [N_s, bin_s] = histc(sniffData.turnTrig_preTurnDistDiff(:,jj), edges);
        turns = sniffData.turnTrig_turnDirs(bin_s==ii);
        turnToP(ii,jj) = sum(turns>0)./numel(turns);
    end
end
 
figure;
subplot(1,3,1);
[N, bins] = histc(rsDND, edges);
stairs(edges, N);
hold on;
[N_, bins] = histc(rsND, edges);
stairs(edges, N_s);
xlabel('\Delta Distance from Trail (mm)');
ylabel('Counts');
xlim([-10 10]);

subplot(1,3,2);
%bar(edges(1:end-1),turnp, 'histc');
stairs(edges',mturnp./sampN);
xlabel('\Delta Distance from Trail (mm)');
ylabel('Turning Probability');
xlim([-10 10]);
ylim([0 .5]);